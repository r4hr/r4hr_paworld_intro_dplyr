---
title: "How to Clean your Data Quickly With Tidyverse"
subtitle: "People Analytics World 2021"
author: "Sergio Garcia Mora"
institute: "Data IQ | Club de R para RRHH | Data 4HR"
date: "April 20th, 2021"
output:
  xaringan::moon_reader:
    lib_dir: libs
    seal: false
    css: [default, shinobi, tamu-fonts]
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
---

class: inverse, top, center
background-image: url(Files/cover.png)
background-size: cover

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.retina = 3, warning = FALSE, message = FALSE)
```



```{r metathis, echo=FALSE}
library(metathis)
meta() %>%
  meta_name("github-repo" = "r4hr/r4hr_paworld_intro_dplyr") %>% 
  meta_social(
    title = "How to Clean your Data Quickly With Tidyverse",
    description = paste(
      "This is an introductory tutorial about cleansing data",
      "for the People Analytics World conference 2021",
      " developed by Sergio Garcia Mora"),
    url = "https://how-to-clean-data-quickly.netlify.app/#1",
    image = "https://github.com/r4hr/r4hr_paworld_intro_dplyr/blob/main/Files/cover.png",
    image_alt = paste(
      "A quick introduction to cleaning data in R", 
      "Developed by Sergio Garcia Mora"
    ),
    og_type = "website",
    og_author = "Sergio Garcia Mora",
    twitter_card_type = "summary_large_image",
    twitter_creator = "@sergiogarciamor",
    twitter_site = "@data4hr"
  )
```
---
class: top, center
background-image: url(Files/dataiq1.png)
background-size: contain


---
class:  top, center
background-image: url(Files/dataiq2.png)
background-size: contain

---

class: top, center
background-image: url(Files/dataiq3.png)
background-size: cover

---
class: inverse, top, center
background-image: url(Files/team.png)
background-size: cover

---
# Club de R para RRHH
.left-column[
.middle[
<img src="Files/clubder.png" />
]
]

.right-column[
The [Club de R para RRHH](https://linktr.ee/r4hrclub) is a community for learning to code in R for people who work in Human Resources or aspire to work in this field.

We develop resources in Spanish, use HR data in our examples, and we learn how to use different packages, learn how to make predictive analysis, text mining and so on.

This is a project that has gathered people from Perú, Chile, Paraguay, Colombia, Spain, Uruguay, Panamá, Argentina and many more `r emo::ji("globe")`.
]

---
class: inverse, middle, center
## Let's get to work!

<img src="https://media.giphy.com/media/3o7TKUM3IgJBX2as9O/giphy.gif" width="60%"/>


---
# The R language
## Projects

Working with projects in RStudio makes everything simpler. RStudio Projects create a local folder in your computer in which every file, script, and resources will be saved there, in a more organized way.

--

To create a project go to:
* *File*
  * *New project*

And then write the name of the new folder.

.pull-left[<img src="Files/new_project.png" width="60%" />]


.pull-rigt[<img src="Files/new_projecto.png" width="30%" />]

---
# What's a R package?

R is a open source language, that became very popular for analyzing data and statistical analysis. Nowadays it has a wide range of aplications and uses beyond statistics.

--

*Packages* are a sort of 'extensions' that expand R base capabilities and allows us to make specific things in a easy way. Pablo Tiscornia made a great analogy to explain the difference what packages are.

--

.pull-left[
<img src="Files/R2.png" width="85%" />
]

--
.pull-right[
<img src="Files/R4.png" />
]

---
# Tidy data

.left-column[
<img src="Files/mess.png" />
]

.right-column[
Data in tutorials is perfect, neat, and clean. And everytime you try to replicate the same analyisis with your own data, things rarely work in the same way, and you end up spending a lot of time getting your data right to run an analysis... in Excel `r emo::ji("doubt")`
]
--
.right-column[
That's why cleaning and tidying your data explains from 60 al 80% of the time of any Analytics project. This process is known as *data cleansing* or *data wrangling*. **Tidyverse** is collection of packages that allow us to get our **tidy data** to develop our analysis. There are some **tidy data principles** we all need to know:
]
--
.right-column[
1. Each variable must have its own column.
2. Each observation must have its own row.
3. Each value must have its own cell.
]

---
background-color: #BDCBD4
# Tidyverse

Tidyverse is a collection of packaged for cleaning, transforming, manipulating and wrangling data. 

.center[<img src="Files/tidyverse_packs.jpeg" width="40%"/>]

To start using we have to install it. This is a one time process, and all you have to do is type in your RStudio console
```{r install, echo=TRUE, eval=FALSE}

# Install tidyverse packages for the first time
install.packages("tidyverse")

```

---
# Tidyverse

Once the package is installed, we need to load or "activate" the package in order to use its functions. We need the `library()` function to do it.

```{r echo = TRUE, message=TRUE, warning=TRUE}
# Load tiverse packages
library(tidyverse)
```

---
## dplyr

.left-column[
<img src="https://i.redd.it/w2km14a81yy41.png" />
]

.right-column[
**dplyr** is the main package of the *tidyverse* collection for *data wrangling*.

One of the reasons it became so popular is that its functions emulates our colloquial way to approach a problem.

Another important factor is that the function names are straight forward to comprehend what they do, and the logic and parameters in most of them are very similar.

That means when you understand the basics of one function you get an idea of how they all work.
]

---
## dplyr, an example

Let's take a look into a dplyr's sequence:

Let's say you have a salary survey and you want to know the mean salary for HR positions. Can you tell me the steps of this script?:

--

```{r eval=FALSE}
hr_data %>%                               # Call the dataframe
  select(position, salary) %>%            # Picks columns to analyse
  filter(salary < 500000) %>%             # Filter salaries below $ 500.000
  group_by(position) %>%                  # Groups the results by position
  summarise(mean_salary = mean(salary))   # Calculate mean salary for position
```




---
## The 'pipe' operator

.left-column[
<img src="https://magrittr.tidyverse.org/logo.png" />
]

.right-column[
Did you see this symbol `%>%` in the previous slide? This symbol is known as the **'pipe'** and allows you to write functions as a sequence, making it easier to read and understand the script. This is particularly useful when you're concatenating several steps of functions in your analysis.
]
.right-column[
Let's imagine you want to get a list of HRBP's salaries per industry, organized from highest salary, to the lowest. 
]

--
.right-column[**Steps:**

1. Load data, and select `role`, `base_salary` and `industry`variables.
2. Filter by `role == "HRBP"`
3. Arrange results descendently by `base_salary`.
]
---
## The 'pipe' operator

This is how the codes looks like

```{r, echo= TRUE, eval=FALSE}
# Code WITHOUT the pipe operator
arrange(filter(select(salaries, role, base_salary, industry), role == "HRBP"), desc(base_salary))
```

--

```{r, echo= TRUE, eval=FALSE}
# Code WITH the pipe operator
salaries %>% 
  select(role, base_salary, industry) %>% 
  filter(role == "HRBP") %>% 
  arrange(desc(base_salary))
```

---
class: inverse, middle, center
# Let's get to know our data

---
# `r emo::ji("kiwi")` KIWI: Key Investigation of Wages & Income
## aka HR Salary Survey from Argentina

Last year, with the *Club de R para RRHH* conducted a salary survey across Latin America to know salaries and some other things that we were interested on.

The other reason why we did this survey is because the lack of datasets in Spanish to practice.

In this workshop we'll use a sample of this dataset using data from Argentina. You can see and download the R script a full version of the analysis [in this link](https://rpubs.com/Data4HR/encuesta-kiwi-2020).

---
# The KIWI data

First, we need to load the `tidyverse` package and use a function from the `readr` package to load the data.

```{r data-load}
library(tidyverse)

# The url link to the location of the dataset
url_link <- "https://raw.githubusercontent.com/r4hr/r4hr_paworld_intro_dplyr/main/salary_survey_ar.csv"

# Load the csv file from GitHub
salaries <- read_delim(url_link,    #<<
                       delim = ";") #<<

```

---
## A `glimpse` into the KIWI data

```{r glimpse}
# Let's explore the structure of the dataset
glimpse(salaries)
```

```{r echo=FALSE}
options(scipen = 999)
```

---
## Let's explore the data

.pull-left[
One of the main things we want to explore are salaries, so, first, we have to know its distribution. Let's plot a histogram.

```{r hist1, out.width="70%"}
ggplot(salaries, 
       aes(x = base_salary)) +
  geom_histogram()
```

]

--
.pull-right[
What happened here? `r emo::ji("surprised")`

Let's take a look into the variable.

```{r summary1}
summary(salaries$base_salary)
```

]